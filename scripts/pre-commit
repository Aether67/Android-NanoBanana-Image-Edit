#!/bin/sh
# Pre-commit hook for NanoBanana AI Image Editor
# Runs code quality checks before allowing a commit
#
# Installation:
# cp scripts/pre-commit .git/hooks/pre-commit
# chmod +x .git/hooks/pre-commit

echo "Running pre-commit checks..."

# Run ktlint check
echo "ğŸ“‹ Running ktlint..."
./gradlew ktlintCheck --daemon
if [ $? -ne 0 ]; then
    echo "âŒ ktlint check failed. Please fix the formatting issues."
    echo "You can run './gradlew ktlintFormat' to auto-fix most issues."
    exit 1
fi

# Run detekt
echo "ğŸ” Running Detekt..."
./gradlew detekt --daemon
if [ $? -ne 0 ]; then
    echo "âŒ Detekt found issues. Please fix them before committing."
    echo "Check the report at build/reports/detekt/detekt.html"
    exit 1
fi

# Run unit tests
echo "ğŸ§ª Running unit tests..."
./gradlew testDebugUnitTest --daemon
if [ $? -ne 0 ]; then
    echo "âŒ Unit tests failed. Please fix failing tests."
    exit 1
fi

echo "âœ… All pre-commit checks passed!"
exit 0
